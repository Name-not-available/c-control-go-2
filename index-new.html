<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Savor Delicious Flavors of the Food Boulevard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Schematic placeholder style */
        .schematic-img {
            background-color: #e5e7eb;
            background-image: linear-gradient(45deg, #f3f4f6 25%, transparent 25%, transparent 75%, #f3f4f6 75%, #f3f4f6), 
                              linear-gradient(45deg, #f3f4f6 25%, transparent 25%, transparent 75%, #f3f4f6 75%, #f3f4f6);
            background-size: 10px 10px;
            background-position: 0 0, 5px 5px;
        }

        .restaurant-box {
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .restaurant-box:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 p-4 min-h-screen flex justify-center items-start">

    <!-- Main Container representing the board -->
    <div class="bg-white w-full max-w-[1400px] shadow-2xl overflow-hidden rounded-lg flex flex-col">
        
        <!-- Header -->
        <header class="bg-gray-100 p-6 border-b border-gray-300 flex justify-between items-center">
            <h1 class="text-2xl md:text-4xl font-extrabold text-gray-800 uppercase tracking-tight">
                Savor Delicious Flavors of the Food Boulevard
            </h1>
            <div class="hidden md:flex flex-col items-end text-sm text-gray-600">
                <span class="font-bold">READY TO EAT?</span>
                <span>SCAN AND GO!</span>
                <div class="w-12 h-12 bg-black mt-1"></div> <!-- QR Code Placeholder -->
            </div>
        </header>

        <!-- Search Section -->
        <div class="bg-white p-4 border-b border-gray-300">
            <div class="flex flex-col md:flex-row gap-3">
                <input 
                    type="number" 
                    id="latitude" 
                    placeholder="Latitude (e.g., 40.7128)" 
                    step="any"
                    class="flex-1 px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none"
                >
                <input 
                    type="number" 
                    id="longitude" 
                    placeholder="Longitude (e.g., -74.0060)" 
                    step="any"
                    class="flex-1 px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none"
                >
                <button 
                    onclick="searchRestaurants()" 
                    class="px-6 py-2 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 transition-colors"
                >
                    üîç Search
                </button>
                <button 
                    onclick="getCurrentLocation()" 
                    class="px-6 py-2 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition-colors"
                >
                    üìç My Location
                </button>
            </div>
            <div id="error" class="hidden mt-3 bg-red-50 border-l-4 border-red-500 text-red-700 p-3 rounded"></div>
            <div id="loading" class="hidden mt-3 text-center">
                <div class="inline-block">
                    <div class="loading-spinner w-8 h-8 mx-auto mb-2"></div>
                    <p class="text-sm text-gray-600">Searching for restaurants...</p>
                </div>
            </div>
        </div>

        <!-- Content Area -->
        <div class="flex flex-col md:flex-row h-full">
            
            <!-- LEFT COLUMN (Yellow) -->
            <div class="w-full md:w-[40%] bg-[#FCEDA5] flex flex-col relative" id="left-column">
                
                <!-- Floor 3 -->
                <div class="flex p-4 border-b border-yellow-300/50" id="floor-3-left">
                    <div class="text-4xl font-black text-gray-800 w-12 pt-2">3</div>
                    <div class="flex-1 grid grid-cols-4 gap-2" id="floor-3-left-grid">
                        <!-- Restaurants will be populated here -->
                    </div>
                </div>

                <!-- Floor 2 & 1 Row -->
                <div class="flex p-4 border-b border-yellow-300/50">
                    <!-- Floor 2 -->
                    <div class="flex items-start mr-4">
                        <div class="text-4xl font-black text-gray-800 w-8 pt-2">2</div>
                        <div class="w-20">
                            <div class="flex-1 grid grid-cols-1 gap-2" id="floor-2-left-grid">
                                <!-- Restaurants will be populated here -->
                            </div>
                        </div>
                    </div>
                    <!-- Floor 1 -->
                    <div class="flex items-start flex-1">
                        <div class="text-4xl font-black text-gray-800 w-8 pt-2">1</div>
                        <div class="flex-1 grid grid-cols-4 gap-2" id="floor-1-left-grid">
                            <!-- Restaurants will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Floor G -->
                <div class="flex p-4 border-b border-yellow-300/50" id="floor-g-left">
                    <div class="text-4xl font-black text-gray-800 w-12 pt-2">G</div>
                    <div class="flex-1 grid grid-cols-4 gap-2" id="floor-g-left-grid">
                        <!-- Restaurants will be populated here -->
                    </div>
                </div>

                <!-- Floor B1 -->
                <div class="flex p-4 flex-1" id="floor-b1-left">
                    <div class="text-4xl font-black text-gray-800 w-12 pt-2">B1</div>
                    <div class="flex-1 grid grid-cols-4 gap-2" id="floor-b1-left-grid">
                        <!-- Restaurants will be populated here -->
                    </div>
                </div>

                 <!-- Floor 1 Red Footer -->
                 <div class="bg-[#D93846] p-4 flex text-white mt-auto">
                    <div class="text-4xl font-black w-12 pt-1">1</div>
                    <div class="w-32">
                        <div id="floor-1-red-grid" class="grid grid-cols-1 gap-2">
                            <!-- Restaurants will be populated here -->
                        </div>
                    </div>
                 </div>

            </div>

            <!-- RIGHT COLUMN (Blue) -->
            <div class="w-full md:w-[60%] bg-[#6BB5F6] flex flex-col" id="right-column">
                
                <!-- Floor 5 -->
                <div class="flex p-4 border-b border-blue-400/50" id="floor-5-right">
                    <div class="text-4xl font-black text-white w-12 pt-2">5</div>
                    <div class="flex-1 grid grid-cols-6 gap-2" id="floor-5-right-grid">
                        <!-- Restaurants will be populated here -->
                    </div>
                </div>

                <!-- Floor 3 -->
                <div class="flex p-4 border-b border-blue-400/50" id="floor-3-right">
                    <div class="text-4xl font-black text-white w-12 pt-2">3</div>
                    <div class="flex-1 grid grid-cols-6 gap-2" id="floor-3-right-grid">
                        <!-- Restaurants will be populated here -->
                    </div>
                </div>

                <!-- Row for G, 1, 2 -->
                <div class="flex p-4 border-b border-blue-400/50 items-center">
                    
                    <!-- G -->
                    <div class="flex flex-col items-center mr-6">
                        <div class="text-4xl font-black text-white mb-2">G</div>
                        <div class="flex gap-2" id="floor-g-right-grid">
                            <!-- Restaurants will be populated here -->
                        </div>
                    </div>

                    <!-- 1 -->
                    <div class="flex flex-col items-center mr-6 border-l border-blue-400/50 pl-6">
                         <div class="text-4xl font-black text-white mb-2">1</div>
                         <div class="flex gap-2" id="floor-1-right-grid">
                            <!-- Restaurants will be populated here -->
                         </div>
                    </div>

                    <!-- 2 -->
                    <div class="flex flex-col items-center border-l border-blue-400/50 pl-6">
                         <div class="text-4xl font-black text-white mb-2">2</div>
                         <div class="flex gap-2" id="floor-2-right-grid">
                            <!-- Restaurants will be populated here -->
                         </div>
                    </div>
                </div>

                <!-- Floor B1 -->
                <div class="flex p-4" id="floor-b1-right">
                    <div class="text-4xl font-black text-white w-12 pt-2">B1</div>
                    <div class="flex-1 grid grid-cols-6 gap-2" id="floor-b1-right-grid">
                        <!-- Restaurants will be populated here -->
                    </div>
                </div>

                <!-- Footer Depachika -->
                <div class="mt-auto bg-[#D6EAF8] p-6 text-gray-700 text-xs">
                    <div class="flex flex-col md:flex-row gap-8">
                        <div>
                            <h3 class="text-red-500 font-bold text-lg mb-2">Restaurant<br>Preview<br>PRO</h3>
                        </div>
                        
                        <div class="flex-1">
                            <h4 class="font-bold mb-1">PARTNERS</h4>
                            <p class="leading-relaxed opacity-70">
                                NAME 1 | NAME 2 | NAME 3 | NAME 4 | NAME 5 | NAME 6 | NAME 7 | NAME 8 | NAME 9 | NAME 10
                            </p>
                        </div>

                        <div class="flex-1">
                            <h4 class="font-bold mb-1">US</h4>
                            <p class="leading-relaxed opacity-70">
                                NAME 1 | NAME 2 | NAME 3 | NAME 4 | NAME 5 | NAME 6 | NAME 7 | NAME 8 | NAME 9 | NAME 10
                            </p>
                        </div>

                         <div class="flex-1">
                            <h4 class="font-bold mb-1">ABOUT US</h4>
                            <p class="leading-relaxed opacity-70">
                                We are cool
                            </p>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // Floor grid configurations
        const floorGrids = [
            { id: 'floor-3-left-grid', cols: 4, isBlue: false },
            { id: 'floor-2-left-grid', cols: 1, isBlue: false },
            { id: 'floor-1-left-grid', cols: 4, isBlue: false },
            { id: 'floor-g-left-grid', cols: 4, isBlue: false },
            { id: 'floor-b1-left-grid', cols: 4, isBlue: false },
            { id: 'floor-1-red-grid', cols: 1, isBlue: false, isRed: true },
            { id: 'floor-5-right-grid', cols: 6, isBlue: true },
            { id: 'floor-3-right-grid', cols: 6, isBlue: true },
            { id: 'floor-g-right-grid', cols: 2, isBlue: true, isHorizontal: true },
            { id: 'floor-1-right-grid', cols: 3, isBlue: true, isHorizontal: true },
            { id: 'floor-2-right-grid', cols: 3, isBlue: true, isHorizontal: true },
            { id: 'floor-b1-right-grid', cols: 6, isBlue: true }
        ];

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
            setTimeout(() => {
                errorDiv.classList.add('hidden');
            }, 5000);
        }

        function showLoading(show) {
            document.getElementById('loading').classList.toggle('hidden', !show);
        }

        function getCurrentLocation() {
            if (!navigator.geolocation) {
                showError('Geolocation is not supported by your browser');
                return;
            }

            showLoading(true);
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    document.getElementById('latitude').value = position.coords.latitude;
                    document.getElementById('longitude').value = position.coords.longitude;
                    showLoading(false);
                    searchRestaurants();
                },
                (error) => {
                    showLoading(false);
                    showError('Unable to get your location: ' + error.message);
                }
            );
        }

        function formatDistance(distanceKm) {
            if (distanceKm < 1.0) {
                return Math.round(distanceKm * 1000) + 'm';
            }
            return distanceKm.toFixed(2) + 'km';
        }

        function getRestaurantImageUrl(restaurant) {
            // Use a simple approach - create a colored gradient based on restaurant name
            const hash = restaurant.Name.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
            const hue = hash % 360;
            return `data:image/svg+xml,${encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="400" height="300"><rect width="400" height="300" fill="hsl(${hue}, 70%, 50%)"/><text x="50%" y="50%" text-anchor="middle" dy=".3em" fill="white" font-size="24" font-weight="bold">${restaurant.Name}</text></svg>`)}`;
        }

        function createRestaurantBox(restaurant, index, isBlue = false, isRed = false) {
            const box = document.createElement('div');
            box.className = 'restaurant-box flex flex-col gap-1 w-full aspect-[4/3]';
            
            const mapsURL = `https://www.google.com/maps/search/?api=1&query=${restaurant.Latitude},${restaurant.Longitude}`;
            
            // Add image
            const imgContainer = document.createElement('div');
            imgContainer.className = 'schematic-img w-full h-[70%] rounded-sm border border-black/5 relative overflow-hidden';
            
            const img = document.createElement('img');
            img.src = getRestaurantImageUrl(restaurant);
            img.className = 'w-full h-full object-cover';
            img.alt = restaurant.Name;
            img.onerror = function() {
                this.style.display = 'none';
            };
            imgContainer.appendChild(img);
            
            // Add rating badge if available
            if (restaurant.Rating > 0) {
                const ratingBadge = document.createElement('div');
                ratingBadge.className = 'absolute top-1 left-1 bg-yellow-400 text-yellow-900 text-[8px] font-bold px-1.5 py-0.5 rounded';
                ratingBadge.textContent = `‚≠ê ${restaurant.Rating.toFixed(1)}`;
                imgContainer.appendChild(ratingBadge);
            }
            
            box.appendChild(imgContainer);

            // Add text label
            const textLabel = document.createElement('div');
            textLabel.textContent = restaurant.Name;
            textLabel.className = 'text-[9px] font-bold leading-tight truncate text-center';
            
            if (isRed) {
                textLabel.classList.add('text-red-600');
            } else if (isBlue) {
                textLabel.classList.add('text-white');
            } else {
                textLabel.classList.add('text-gray-800');
            }
            
            box.appendChild(textLabel);

            // Add distance info
            const distanceLabel = document.createElement('div');
            distanceLabel.textContent = formatDistance(restaurant.Distance);
            distanceLabel.className = 'text-[7px] text-gray-500 text-center';
            box.appendChild(distanceLabel);

            // Add click handler to open maps
            box.onclick = () => window.open(mapsURL, '_blank');
            box.title = `${restaurant.Name}\n${restaurant.Address || 'No address'}\nDistance: ${formatDistance(restaurant.Distance)}`;

            return box;
        }

        function clearAllGrids() {
            floorGrids.forEach(grid => {
                const element = document.getElementById(grid.id);
                if (element) {
                    element.innerHTML = '';
                }
            });
        }

        function populateGrids(restaurants) {
            clearAllGrids();
            
            let restaurantIndex = 0;
            
            floorGrids.forEach(grid => {
                const element = document.getElementById(grid.id);
                if (!element) return;
                
                const maxItems = grid.isHorizontal ? grid.cols : grid.cols * 2; // Allow 2 rows for vertical grids
                const itemsToAdd = Math.min(maxItems, restaurants.length - restaurantIndex);
                
                for (let i = 0; i < itemsToAdd && restaurantIndex < restaurants.length; i++) {
                    const box = createRestaurantBox(
                        restaurants[restaurantIndex], 
                        restaurantIndex, 
                        grid.isBlue, 
                        grid.isRed || false
                    );
                    element.appendChild(box);
                    restaurantIndex++;
                }
            });
        }

        function searchRestaurants() {
            const lat = parseFloat(document.getElementById('latitude').value);
            const lon = parseFloat(document.getElementById('longitude').value);

            if (isNaN(lat) || isNaN(lon)) {
                showError('Please enter valid latitude and longitude values');
                return;
            }

            showLoading(true);
            clearAllGrids();

            fetch(`/api/restaurants?lat=${lat}&lon=${lon}`)
                .then(response => {
                    if (!response.ok) {
                        return response.text().then(text => {
                            throw new Error(text || 'Failed to fetch restaurants');
                        });
                    }
                    return response.json();
                })
                .then(restaurants => {
                    showLoading(false);
                    if (restaurants.length === 0) {
                        showError('No restaurants found. Try a different location.');
                        return;
                    }

                    populateGrids(restaurants);
                })
                .catch(error => {
                    showLoading(false);
                    showError('Error: ' + error.message);
                    console.error('Error:', error);
                });
        }

        // Allow Enter key to trigger search
        document.getElementById('latitude').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') searchRestaurants();
        });
        document.getElementById('longitude').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') searchRestaurants();
        });
    </script>
</body>
</html>
